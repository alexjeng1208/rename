# æª”æ¡ˆé‡æ–°å‘½åå·¥å…· - é–‹ç™¼è€…æ–‡æª”

## ğŸ“ å°ˆæ¡ˆçµæ§‹ï¼ˆv2.0ï¼‰

```
rename/
â”œâ”€â”€ file_renamer_v2.py          # ä¸»ç¨‹å¼ï¼ˆv2.0 å„ªåŒ–ç‰ˆï¼‰
â”œâ”€â”€ file_renamer.py             # åŸç‰ˆæœ¬ï¼ˆv1.0ï¼Œä¿ç•™ä¾›åƒè€ƒï¼‰
â”œâ”€â”€ config.py                   # é…ç½®å’Œå¸¸æ•¸å®šç¾©
â”œâ”€â”€ naming_rules.py             # å‘½åè¦å‰‡å¼•æ“
â”œâ”€â”€ file_operations.py          # æª”æ¡ˆæ“ä½œç®¡ç†å™¨
â”œâ”€â”€ settings_manager.py         # è¨­å®šç®¡ç†å™¨
â”œâ”€â”€ ui_helpers.py               # UI è¼”åŠ©å·¥å…·
â”œâ”€â”€ requirements.txt            # Python ä¾è³´å¥—ä»¶
â”œâ”€â”€ build_exe.bat              # Windows æ‰“åŒ…è…³æœ¬
â”œâ”€â”€ install_dependencies.bat    # ä¾è³´å®‰è£è…³æœ¬
â”œâ”€â”€ README.md                   # ä½¿ç”¨è€…èªªæ˜æ–‡æª”
â”œâ”€â”€ æ‰“åŒ…èªªæ˜.md                 # æ‰“åŒ…è©³ç´°èªªæ˜
â””â”€â”€ é–‹ç™¼è€…æ–‡æª”.md               # æœ¬æ–‡æª”
```

## ğŸ—ï¸ æ¨¡çµ„æ¶æ§‹

### 1. `config.py` - é…ç½®æ¨¡çµ„
**åŠŸèƒ½**ï¼šé›†ä¸­ç®¡ç†æ‰€æœ‰å¸¸æ•¸å’Œé…ç½®

**ä¸»è¦å…§å®¹**ï¼š
- æ‡‰ç”¨ç¨‹å¼è³‡è¨Šï¼ˆæ¨™é¡Œã€ç‰ˆæœ¬è™Ÿï¼‰
- æ”¯æ´çš„æª”æ¡ˆæ ¼å¼
- é¡è‰²æ˜ å°„
- ä¸»é¡Œé¸é …
- UI é…ç½®
- éµç›¤å¿«æ·éµå®šç¾©
- ä¸»é¡Œé¡è‰²å®šç¾©

**ä½¿ç”¨ç¯„ä¾‹**ï¼š
```python
from config import APP_TITLE, COLOR_MAP, SHORTCUTS
```

### 2. `naming_rules.py` - å‘½åè¦å‰‡å¼•æ“
**åŠŸèƒ½**ï¼šè™•ç†æª”æ¡ˆå‘½åé‚è¼¯

**ä¸»è¦é¡åˆ¥**ï¼š
- `NamingRuleEngine`: å‘½åè¦å‰‡å¼•æ“ä¸»é¡

**æ ¸å¿ƒæ–¹æ³•**ï¼š
- `set_rule_type(rule_type)`: è¨­ç½®è¦å‰‡é¡å‹ï¼ˆcharacter/dreamï¼‰
- `set_char_params(**kwargs)`: è¨­ç½® Character è¦å‰‡åƒæ•¸
- `set_dream_params(**kwargs)`: è¨­ç½®å¤¢æƒ³è¦å‰‡åƒæ•¸
- `generate_filename(original_path, index)`: ç”Ÿæˆæ–°æª”å
- `validate_params()`: é©—è­‰åƒæ•¸æœ‰æ•ˆæ€§
- `set_file_char_id(file_path, char_id)`: ç‚ºç‰¹å®šæª”æ¡ˆè¨­å®šè§’è‰²ç·¨è™Ÿ
- `get_params_dict()`: ç²å–åƒæ•¸å­—å…¸ï¼ˆç”¨æ–¼ä¿å­˜ï¼‰
- `load_params_dict(params)`: è¼‰å…¥åƒæ•¸å­—å…¸ï¼ˆç”¨æ–¼è®€å–ï¼‰

**ä½¿ç”¨ç¯„ä¾‹**ï¼š
```python
from naming_rules import NamingRuleEngine

engine = NamingRuleEngine()
engine.set_rule_type("character")
engine.set_char_params(char_id="01", char_type="Idle", char_index="01")
new_name = engine.generate_filename("/path/to/file.mp4", 0)
```

### 3. `file_operations.py` - æª”æ¡ˆæ“ä½œç®¡ç†å™¨
**åŠŸèƒ½**ï¼šè™•ç†æ‰€æœ‰æª”æ¡ˆç›¸é—œæ“ä½œ

**ä¸»è¦é¡åˆ¥**ï¼š
- `FileOperationManager`: æª”æ¡ˆæ“ä½œç®¡ç†å™¨

**æ ¸å¿ƒæ–¹æ³•**ï¼š
- `add_files(files)`: æ·»åŠ æª”æ¡ˆåˆ°åˆ—è¡¨
- `add_folder(folder_path)`: å¾è³‡æ–™å¤¾æ·»åŠ æª”æ¡ˆ
- `remove_files(indices)`: ç§»é™¤æª”æ¡ˆ
- `move_file(index, direction)`: ç§»å‹•æª”æ¡ˆä½ç½®
- `execute_rename(rename_list)`: åŸ·è¡Œæ‰¹æ¬¡é‡æ–°å‘½å
- `undo_last_rename()`: æ’¤éŠ·ä¸Šæ¬¡æ“ä½œ
- `check_conflicts(rename_list)`: æª¢æŸ¥å‘½åè¡çª
- `can_undo()`: æª¢æŸ¥æ˜¯å¦å¯æ’¤éŠ·
- `load_history()`: è¼‰å…¥æ­·å²è¨˜éŒ„
- `get_files()`: ç²å–æª”æ¡ˆåˆ—è¡¨

**ä½¿ç”¨ç¯„ä¾‹**ï¼š
```python
from file_operations import FileOperationManager

manager = FileOperationManager()
manager.add_files(["/path/to/file1.mp4", "/path/to/file2.jpg"])
files = manager.get_files()
```

### 4. `settings_manager.py` - è¨­å®šç®¡ç†å™¨
**åŠŸèƒ½**ï¼šè™•ç†ç”¨æˆ¶è¨­å®šçš„ä¿å­˜å’Œè¼‰å…¥

**ä¸»è¦é¡åˆ¥**ï¼š
- `SettingsManager`: è¨­å®šç®¡ç†å™¨

**æ ¸å¿ƒæ–¹æ³•**ï¼š
- `load_settings()`: è¼‰å…¥è¨­å®šæª”æ¡ˆ
- `save_settings()`: ä¿å­˜è¨­å®šæª”æ¡ˆ
- `get(key, default)`: ç²å–è¨­å®šå€¼ï¼ˆæ”¯æ´é»è™Ÿè·¯å¾‘ï¼‰
- `set(key, value)`: è¨­ç½®è¨­å®šå€¼ï¼ˆæ”¯æ´é»è™Ÿè·¯å¾‘ï¼‰
- `update_window_geometry(geometry)`: æ›´æ–°è¦–çª—å¹¾ä½•
- `update_last_folder(folder)`: æ›´æ–°æœ€å¾Œä½¿ç”¨çš„è³‡æ–™å¤¾
- `update_naming_rule(rule_params)`: æ›´æ–°å‘½åè¦å‰‡
- `toggle_theme()`: åˆ‡æ›ä¸»é¡Œ
- `reset_to_default()`: é‡ç½®ç‚ºé è¨­å€¼

**è¨­å®šæª”æ¡ˆæ ¼å¼**ï¼ˆJSONï¼‰ï¼š
```json
{
  "window": {
    "geometry": "1200x1000+100+100",
    "theme": "light"
  },
  "last_folder": "/path/to/folder",
  "max_files": 0,
  "naming_rule": {
    "rule_type": "character",
    "char_params": {...},
    "dream_params": {...}
  }
}
```

**ä½¿ç”¨ç¯„ä¾‹**ï¼š
```python
from settings_manager import SettingsManager

settings = SettingsManager()
settings.load_settings()
last_folder = settings.get("last_folder", "")
settings.set("max_files", 100)
settings.save_settings()
```

### 5. `ui_helpers.py` - UI è¼”åŠ©å·¥å…·
**åŠŸèƒ½**ï¼šæä¾›é€šç”¨çš„ UI çµ„ä»¶å’Œè¼”åŠ©å‡½æ•¸

**ä¸»è¦é¡åˆ¥**ï¼š
- `ToolTip`: å·¥å…·æç¤ºé¡
- `ProgressDialog`: é€²åº¦å°è©±æ¡†
- `SearchBar`: æœå°‹åˆ—æ§ä»¶
- `StatusBar`: ç‹€æ…‹åˆ—æ§ä»¶

**è¼”åŠ©å‡½æ•¸**ï¼š
- `create_scrollable_frame(parent)`: å‰µå»ºå¯æ»¾å‹•æ¡†æ¶
- `center_window(window, width, height)`: å±…ä¸­é¡¯ç¤ºè¦–çª—

**ä½¿ç”¨ç¯„ä¾‹**ï¼š
```python
from ui_helpers import ToolTip, StatusBar

# æ·»åŠ å·¥å…·æç¤º
tooltip = ToolTip(button, "é€™æ˜¯ä¸€å€‹æŒ‰éˆ•çš„èªªæ˜")

# å‰µå»ºç‹€æ…‹åˆ—
status_bar = StatusBar(root)
status_bar.set_message("å°±ç·’")
```

### 6. `file_renamer_v2.py` - ä¸»ç¨‹å¼
**åŠŸèƒ½**ï¼šæ•´åˆæ‰€æœ‰æ¨¡çµ„ï¼Œæä¾› GUI ä»‹é¢

**ä¸»è¦é¡åˆ¥**ï¼š
- `FileRenamerGUI`: ä¸»è¦–çª—é¡

**æ ¸å¿ƒåŠŸèƒ½å€å¡Š**ï¼š
- `setup_ui()`: è¨­ç½®ä½¿ç”¨è€…ä»‹é¢
- `create_menu_bar()`: å‰µå»ºé¸å–®åˆ—
- `create_character_rule_ui()`: å‰µå»º Character è¦å‰‡ UI
- `create_dream_rule_ui()`: å‰µå»ºå¤¢æƒ³è¦å‰‡ UI
- `create_preview_ui()`: å‰µå»ºé è¦½å€åŸŸ
- `setup_shortcuts()`: è¨­ç½®å¿«æ·éµ
- `setup_drag_drop()`: è¨­ç½®æ‹–æ”¾åŠŸèƒ½
- å„ç¨®äº‹ä»¶è™•ç†æ–¹æ³•...

## ğŸ”„ è³‡æ–™æµç¨‹

### 1. ç¨‹å¼å•Ÿå‹•æµç¨‹
```
main()
  â†’ å‰µå»º Tk è¦–çª—
  â†’ FileRenamerGUI.__init__()
    â†’ åˆå§‹åŒ– SettingsManager
    â†’ åˆå§‹åŒ– NamingRuleEngine
    â†’ åˆå§‹åŒ– FileOperationManager
    â†’ è¼‰å…¥è¨­å®šå’Œæ­·å²
    â†’ è¨­ç½® UI
    â†’ ç¶å®šå¿«æ·éµ
  â†’ root.mainloop()
```

### 2. æª”æ¡ˆé‡å‘½åæµç¨‹
```
ç”¨æˆ¶é»æ“Šã€ŒåŸ·è¡Œé‡æ–°å‘½åã€
  â†’ execute_rename()
    â†’ ç²å–è¦è™•ç†çš„æª”æ¡ˆåˆ—è¡¨
    â†’ é©—è­‰å‘½åè¦å‰‡åƒæ•¸
    â†’ ç”Ÿæˆé‡å‘½ååˆ—è¡¨ï¼ˆä½¿ç”¨ NamingRuleEngineï¼‰
    â†’ æª¢æŸ¥è¡çªï¼ˆä½¿ç”¨ FileOperationManagerï¼‰
    â†’ ç¢ºèªå°è©±æ¡†
    â†’ åŸ·è¡Œé‡å‘½åï¼ˆFileOperationManager.execute_rename()ï¼‰
    â†’ è¨˜éŒ„æ­·å²ï¼ˆç”¨æ–¼æ’¤éŠ·ï¼‰
    â†’ æ›´æ–° UI å’Œç‹€æ…‹
```

### 3. è¨­å®šä¿å­˜æµç¨‹
```
ç¨‹å¼é—œé–‰æˆ–ç”¨æˆ¶æŒ‰ Ctrl+S
  â†’ on_closing() æˆ– save_settings()
    â†’ æ”¶é›†ç•¶å‰è¨­å®š
      - è¦–çª—å¹¾ä½•
      - å‘½åè¦å‰‡åƒæ•¸
      - å…¶ä»–é¸é …
    â†’ SettingsManager.save_settings()
      â†’ å¯«å…¥ JSON æª”æ¡ˆ
```

### 4. æ’¤éŠ·æµç¨‹
```
ç”¨æˆ¶é»æ“Šã€Œæ’¤éŠ·é‡å‘½åã€æˆ–æŒ‰ Ctrl+Z
  â†’ undo_rename()
    â†’ æª¢æŸ¥æ˜¯å¦å¯æ’¤éŠ·
    â†’ ç¢ºèªå°è©±æ¡†
    â†’ FileOperationManager.undo_last_rename()
      â†’ å¾æ­·å²è¨˜éŒ„è®€å–æ“ä½œ
      â†’ åå‘åŸ·è¡Œé‡å‘½å
      â†’ æ›´æ–°æ­·å²è¨˜éŒ„
    â†’ é¡¯ç¤ºçµæœ
```

## ğŸ¨ UI çµ„ä»¶å±¤æ¬¡

```
Root (TkinterDnD.Tk)
â”œâ”€â”€ MenuBar (é¸å–®åˆ—)
â”‚   â”œâ”€â”€ æª”æ¡ˆé¸å–®
â”‚   â”œâ”€â”€ ç·¨è¼¯é¸å–®
â”‚   â”œâ”€â”€ æª¢è¦–é¸å–®
â”‚   â”œâ”€â”€ å·¥å…·é¸å–®
â”‚   â””â”€â”€ èªªæ˜é¸å–®
â”œâ”€â”€ Toolbar (å·¥å…·åˆ—)
â”œâ”€â”€ FileFrame (æª”æ¡ˆç®¡ç†å€)
â”‚   â”œâ”€â”€ æ§åˆ¶åˆ—ï¼ˆæ•¸é‡é™åˆ¶ã€å®šä½20äººç‰©ï¼‰
â”‚   â”œâ”€â”€ è·¯å¾‘è¼¸å…¥åˆ—
â”‚   â””â”€â”€ SearchBar (æœå°‹åˆ—)
â”œâ”€â”€ ListFrame (æª”æ¡ˆåˆ—è¡¨å€)
â”‚   â”œâ”€â”€ æ§åˆ¶æŒ‰éˆ•ï¼ˆä¸Šç§»ã€ä¸‹ç§»ã€åˆªé™¤ï¼‰
â”‚   â””â”€â”€ Listbox (æª”æ¡ˆåˆ—è¡¨)
â”œâ”€â”€ RuleFrame (å‘½åè¦å‰‡é¸æ“‡)
â”œâ”€â”€ CharFrame (Character è¦å‰‡åƒæ•¸)
â”‚   â”œâ”€â”€ å¿«é€Ÿé¡å‹é¸æ“‡
â”‚   â”œâ”€â”€ åƒæ•¸è¼¸å…¥ï¼ˆè§’è‰²ç·¨è™Ÿã€é¡å‹ã€ç´¢å¼•ï¼‰
â”‚   â””â”€â”€ ColorFrame (é¡è‰²é¸æ“‡)
â”œâ”€â”€ DreamFrame (å¤¢æƒ³è¦å‰‡åƒæ•¸)
â”‚   â”œâ”€â”€ ä¸»é¡Œé¸æ“‡
â”‚   â”œâ”€â”€ è§’è‰²é¡å‹é¸æ“‡
â”‚   â””â”€â”€ AnimeFrame (å‹•æ¼«ç·¨è™Ÿ)
â”œâ”€â”€ PreviewFrame (é è¦½å€)
â”‚   â””â”€â”€ Notebook
â”‚       â”œâ”€â”€ æ–‡å­—é è¦½æ¨™ç±¤é 
â”‚       â””â”€â”€ åœ–ç‰‡é è¦½æ¨™ç±¤é 
â”œâ”€â”€ ButtonFrame (æ“ä½œæŒ‰éˆ•)
â””â”€â”€ StatusBar (ç‹€æ…‹åˆ—)
```

## ğŸ› ï¸ é–‹ç™¼æŒ‡å—

### æ·»åŠ æ–°çš„å‘½åè¦å‰‡

1. åœ¨ `config.py` ä¸­æ·»åŠ æ–°è¦å‰‡çš„å¸¸æ•¸
2. åœ¨ `naming_rules.py` çš„ `NamingRuleEngine` ä¸­ï¼š
   - æ·»åŠ æ–°è¦å‰‡çš„åƒæ•¸
   - å¯¦ä½œç”Ÿæˆæª”åçš„æ–¹æ³•
   - å¯¦ä½œåƒæ•¸é©—è­‰
3. åœ¨ `file_renamer_v2.py` ä¸­ï¼š
   - æ·»åŠ æ–°è¦å‰‡çš„ UI å…ƒç´ 
   - ç¶å®šäº‹ä»¶è™•ç†

### æ·»åŠ æ–°çš„å¿«æ·éµ

1. åœ¨ `config.py` çš„ `SHORTCUTS` å­—å…¸ä¸­å®šç¾©
2. åœ¨ `file_renamer_v2.py` çš„ `setup_shortcuts()` ä¸­ç¶å®š

### æ·»åŠ æ–°çš„ UI çµ„ä»¶

1. åœ¨ `ui_helpers.py` ä¸­å‰µå»ºæ–°çš„é¡åˆ¥
2. åœ¨ä¸»ç¨‹å¼ä¸­å°å…¥ä¸¦ä½¿ç”¨

### ä¿®æ”¹è¨­å®šé …ç›®

1. åœ¨ `settings_manager.py` çš„ `_get_default_settings()` ä¸­æ·»åŠ é è¨­å€¼
2. ä½¿ç”¨ `get()` å’Œ `set()` æ–¹æ³•å­˜å–

## ğŸ“¦ æ‰“åŒ…æˆ EXE

### ä½¿ç”¨è‡ªå‹•æ‰“åŒ…è…³æœ¬ï¼ˆæ¨è–¦ï¼‰

```bash
# åŸ·è¡Œæ‰“åŒ…è…³æœ¬
build_exe.bat
```

### æ‰‹å‹•æ‰“åŒ…

```bash
# å®‰è£ä¾è³´
pip install pyinstaller tkinterdnd2 Pillow

# æ‰“åŒ… v2.0
pyinstaller --name="æª”æ¡ˆé‡æ–°å‘½åå·¥å…·_v2" ^
    --onefile ^
    --windowed ^
    --hidden-import=config ^
    --hidden-import=naming_rules ^
    --hidden-import=file_operations ^
    --hidden-import=settings_manager ^
    --hidden-import=ui_helpers ^
    --collect-all tkinterdnd2 ^
    --collect-all PIL ^
    file_renamer_v2.py
```

## ğŸ§ª æ¸¬è©¦æŒ‡å—

### åŠŸèƒ½æ¸¬è©¦æ¸…å–®

- [ ] æª”æ¡ˆé¸æ“‡å’Œè³‡æ–™å¤¾é¸æ“‡
- [ ] æ‹–æ”¾åŠŸèƒ½
- [ ] æª”æ¡ˆåˆ—è¡¨æ“ä½œï¼ˆä¸Šç§»ã€ä¸‹ç§»ã€åˆªé™¤ï¼‰
- [ ] æœå°‹éæ¿¾åŠŸèƒ½
- [ ] Character è¦å‰‡å‘½å
- [ ] å¤¢æƒ³è¦å‰‡å‘½å
- [ ] 20å€‹äººç‰©æ¨¡å¼
- [ ] é è¦½åŠŸèƒ½ï¼ˆæ–‡å­—å’Œåœ–ç‰‡ï¼‰
- [ ] åŸ·è¡Œé‡æ–°å‘½å
- [ ] æ’¤éŠ·åŠŸèƒ½
- [ ] è¨­å®šä¿å­˜å’Œè¼‰å…¥
- [ ] æ‰€æœ‰å¿«æ·éµ
- [ ] æ·±è‰²æ¨¡å¼åˆ‡æ›
- [ ] è¡çªè™•ç†

### EXE æ¸¬è©¦

1. æ‰“åŒ…å¾Œæ¸¬è©¦åŸºæœ¬åŠŸèƒ½
2. æ¸¬è©¦åœ¨æ²’æœ‰ Python ç’°å¢ƒçš„é›»è…¦ä¸ŠåŸ·è¡Œ
3. æ¸¬è©¦è¨­å®šæª”æ¡ˆå’Œæ­·å²æª”æ¡ˆçš„ç”Ÿæˆ
4. æ¸¬è©¦æ‹–æ”¾åŠŸèƒ½
5. æ¸¬è©¦æ‰€æœ‰å¿«æ·éµ

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

**Q: æ‰“åŒ…å¾Œ EXE ç„¡æ³•å•Ÿå‹•**
- æª¢æŸ¥æ˜¯å¦æ‰€æœ‰æ¨¡çµ„éƒ½è¢«æ­£ç¢ºæ‰“åŒ…
- æª¢æŸ¥æ˜¯å¦æœ‰ç¼ºå°‘çš„ hidden-imports
- æŸ¥çœ‹ dist è³‡æ–™å¤¾ä¸­çš„éŒ¯èª¤æ—¥èªŒ

**Q: æ‹–æ”¾åŠŸèƒ½ä¸å¯ç”¨**
- ç¢ºèªå·²å®‰è£ tkinterdnd2
- ç¢ºèªæ‰“åŒ…æ™‚ä½¿ç”¨äº† --collect-all tkinterdnd2

**Q: åœ–ç‰‡é è¦½ä¸é¡¯ç¤º**
- ç¢ºèªå·²å®‰è£ Pillow
- ç¢ºèªæ‰“åŒ…æ™‚ä½¿ç”¨äº† --collect-all PIL

**Q: è¨­å®šç„¡æ³•ä¿å­˜**
- æª¢æŸ¥ç¨‹å¼æ‰€åœ¨ç›®éŒ„æ˜¯å¦æœ‰å¯«å…¥æ¬Šé™
- æª¢æŸ¥ renamer_settings.json æª”æ¡ˆæ ¼å¼æ˜¯å¦æ­£ç¢º

## ğŸ“ ç‰ˆæœ¬æ­·å²

### v2.0 (2024)
- é‡å¤§æ›´æ–°ï¼šæ¨¡çµ„åŒ–é‡æ§‹
- æ–°å¢ï¼šéµç›¤å¿«æ·éµæ”¯æ´
- æ–°å¢ï¼šè¨­å®šè¨˜æ†¶åŠŸèƒ½
- æ–°å¢ï¼šæ’¤éŠ·åŠŸèƒ½
- æ–°å¢ï¼šæª”æ¡ˆæœå°‹éæ¿¾
- æ–°å¢ï¼šç‹€æ…‹åˆ—å’Œå·¥å…·æç¤º
- æ–°å¢ï¼šæ·±è‰²æ¨¡å¼ï¼ˆåŸºç¤ç‰ˆï¼‰
- æ”¹é€²ï¼šæ›´å‹å–„çš„ä½¿ç”¨è€…ä»‹é¢
- æ”¹é€²ï¼šæ›´å®Œå–„çš„éŒ¯èª¤è™•ç†

### v1.0 (åˆå§‹ç‰ˆæœ¬)
- åŸºæœ¬æª”æ¡ˆé‡å‘½ååŠŸèƒ½
- Character å’Œå¤¢æƒ³å…©ç¨®å‘½åè¦å‰‡
- åœ–ç‰‡å’Œå½±ç‰‡é è¦½
- æ‹–æ”¾æ”¯æ´
- 20å€‹äººç‰©æ¨¡å¼

## ğŸ“„ æˆæ¬Š

ç‰ˆæ¬Šæ‰€æœ‰ Â© 2024

## ğŸ¤ è²¢ç»

æ­¡è¿æäº¤å•é¡Œå’Œæ”¹é€²å»ºè­°ï¼
